<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>תשלום באשראי - תשלום אחד - TICO</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;500;600;700&family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body style="margin: 0; padding: 20px; font-family: 'Assistant', 'Heebo', Arial, sans-serif; background-color: #f5f5f7; direction: rtl;">
    <!-- Main container -->
    <table width="700" cellpadding="0" cellspacing="0" border="0" style="margin: 0 auto; background-color: #ffffff; border-radius: 8px; border: 1px solid #e4e4e7; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);">

        <!-- Header: Logo -->
        <tr>
            <td style="padding: 40px 40px 20px 40px; text-align: center;">
                <img src="https://ticovision.vercel.app/brand/tico_logo_transparent.png" width="110" height="48" alt="TICO" style="display: inline-block; border: 0;">
            </td>
        </tr>

        <!-- Title -->
        <tr>
            <td style="padding: 0 40px 24px 40px;">
                <div style="font-size: 24px; line-height: 1.4; font-weight: 700; color: #09090b; text-align: center;">
                    תשלום באשראי - תשלום אחד
                </div>
            </td>
        </tr>

        <!-- Amount to pay with discount explanation -->
        <tr>
            <td style="padding: 0 40px 30px 40px;">
                <div style="background-color: #f3f4f6; border-radius: 8px; padding: 24px; text-align: center;">
                    <div style="font-size: 19px; font-weight: 600; color: #09090b; margin-bottom: 16px;">
                        שמחים שבחרתם בתשלום באשראי בתשלום אחד
                    </div>
                    <div style="font-size: 18px; font-weight: 600; color: #2c3e50; margin-bottom: 12px;">
                        בתמורה משרדנו יעניק לכם הנחה של 8%
                    </div>
                    <div style="font-size: 17px; color: #09090b; line-height: 1.6; margin-bottom: 8px;">
                        הסכום כולל מע"מ לפני הנחה הוא ₪<span id="amount-original">52,000</span>
                    </div>
                    <div style="font-size: 17px; color: #09090b; line-height: 1.6; margin-bottom: 16px;">
                        והסכום לאחר ההנחה הוא ₪<span id="amount-after">47,840</span> כולל מע"מ
                    </div>
                    <div style="border-top: 2px solid #2c3e50; padding-top: 16px; margin-top: 16px;">
                        <div style="font-size: 16px; color: #71717a; margin-bottom: 8px;">
                            סכום לתשלום:
                        </div>
                        <div style="font-size: 36px; font-weight: 700; color: #09090b;">
                            ₪<span id="amount-final">47,840</span>
                        </div>
                    </div>
                </div>
            </td>
        </tr>

        <!-- Border -->
        <tr>
            <td style="padding: 0 40px 30px 40px;">
                <div style="border-top: 1px solid #e4e4e7;"></div>
            </td>
        </tr>

        <!-- Payment explanation -->
        <tr>
            <td style="padding: 0 40px 30px 40px;">
                <div style="font-size: 18px; font-weight: 600; color: #09090b; text-align: right; margin-bottom: 16px;">
                    איך זה עובד?
                </div>
                <div style="font-size: 15px; color: #09090b; line-height: 1.8; text-align: right;">
                    • לחצו על הכפתור למטה<br>
                    • תועברו לדף התשלום המאובטח של Cardcom<br>
                    • מלאו את פרטי כרטיס האשראי<br>
                    • התשלום יבוצע באופן מאובטח ומוצפן<br>
                    • קבלה תישלח אליכם אוטומטית למייל
                </div>
            </td>
        </tr>

        <!-- Important note -->
        <tr>
            <td style="padding: 0 40px 30px 40px;">
                <div style="background-color: #f3f4f6; border: 1px solid #e4e4e7; padding: 20px; border-radius: 6px;">
                    <div style="font-size: 16px; font-weight: 600; color: #09090b; margin-bottom: 8px; text-align: right;">
                        🔒 תשלום מאובטח
                    </div>
                    <div style="font-size: 15px; color: #09090b; line-height: 1.6; text-align: right;">
                        התשלום מבוצע דרך מערכת Cardcom המאובטחת והמוסדרת על ידי בנק ישראל. פרטי כרטיס האשראי שלכם מוצפנים ומאובטחים ב-SSL.
                    </div>
                </div>
            </td>
        </tr>

        <!-- Border -->
        <tr>
            <td style="padding: 0 40px 30px 40px;">
                <div style="border-top: 1px solid #e4e4e7;"></div>
            </td>
        </tr>

        <!-- Payment button -->
        <tr>
            <td style="padding: 0 40px 40px 40px; text-align: center;">
                <div style="font-size: 18px; font-weight: 600; color: #09090b; margin-bottom: 20px;">
                    מוכנים לשלם?
                </div>
                <a id="paymentButton" href="#" style="display: inline-block; background-color: #09090b; color: #ffffff; padding: 16px 48px; border-radius: 6px; font-size: 18px; font-weight: 600; text-decoration: none; font-family: 'Assistant', 'Heebo', Arial, sans-serif;">
                    💳 מעבר לתשלום מאובטח
                </a>
                <div id="demoNotice" style="display: none; background-color: #fff3cd; color: #856404; padding: 16px; border-radius: 6px; margin-top: 20px; font-size: 14px; text-align: center;">
                    🧪 <strong>מצב דמו:</strong> הכפתור מוביל לעמוד הדגמה. בסביבת ייצור, כאן יופיע קישור אמיתי ל-Cardcom.
                </div>
            </td>
        </tr>

        <!-- Footer -->
        <tr>
            <td style="padding: 30px 40px; background-color: #fafafa; border-top: 1px solid #e4e4e7;">
                <div style="font-size: 14px; color: #71717a; text-align: center; line-height: 1.6;">
                    לשאלות ובירורים:<br>
                    <strong>סיגל נגר</strong> | 050-8620993 | sigal@franco.co.il
                </div>
            </td>
        </tr>

    </table>

    <script>
        // Get client_id and amount from URL
        const urlParams = new URLSearchParams(window.location.search);
        const clientId = urlParams.get('client_id') || 'DEMO-2025-001';
        const amountOriginal = urlParams.get('amount') || '52,000';

        // Calculate discount (8% off)
        const cleanAmount = parseFloat(amountOriginal.replace(/,/g, ''));
        const amountAfterDiscount = Math.round(cleanAmount * 0.92);
        const formattedAmountAfter = amountAfterDiscount.toLocaleString('he-IL');

        // Update all amount displays
        document.getElementById('amount-original').textContent = amountOriginal;
        document.getElementById('amount-after').textContent = formattedAmountAfter;
        document.getElementById('amount-final').textContent = formattedAmountAfter;

        // Check if we have real Cardcom credentials or demo mode
        const isDemo = !window.location.hostname.includes('vercel.app');

        if (isDemo) {
            // DEMO MODE: Show demo notice and redirect to demo payment page
            document.getElementById('demoNotice').style.display = 'block';
            document.getElementById('paymentButton').href = '/payment-demo-cardcom.html?client_id=' + clientId + '&amount=' + formattedAmountAfter;
        } else {
            // PRODUCTION: Would call API to generate real Cardcom payment link
            // For now, also use demo page until real credentials are configured
            document.getElementById('demoNotice').style.display = 'block';
            document.getElementById('paymentButton').href = '/payment-demo-cardcom.html?client_id=' + clientId + '&amount=' + formattedAmountAfter;

            // TODO: Replace with real Cardcom link generation:
            /*
            fetch('/api/create-cardcom-link', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    client_id: clientId,
                    amount: amountAfterDiscount,
                    max_payments: 1,
                    description: 'שכר טרחה - תשלום אחד'
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.payment_url) {
                    document.getElementById('paymentButton').href = data.payment_url;
                }
            });
            */
        }
    </script>
</body>
</html>
